apiVersion: batch/v1
kind: CronJob
metadata:
  name: puller-job
spec:
  schedule: "* * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: puller-job
              image: $IMAGE
              envFrom:
                - configMapRef:
                    name: config
                - secretRef:
                    name: secrets
              imagePullPolicy: $IMAGE_POLICY
              command: ["/bin/sh", "-c", "node /home/node/app/dist/job/puller/index.js"]
              volumeMounts: $LOCAL_MOUNT2
          volumes: $LOCAL_VOLUME2
          initContainers:
            - name: wait-for-postgres
              image: postgres:13.4
              imagePullPolicy: "IfNotPresent"
              command: ["/bin/sh", "-c", "pg_isready -h postgres -p 5432 && echo $?"]
          restartPolicy: OnFailure